const express = require('express');
const router = express.Router();
const path2 = require('path');
const auth = require('../middleware/auth');
const userCtrl = require('../controllers/userController');
const adminCtrl = require('../controllers/adminController');
const postCtrl = require('../controllers/postController');

router.use(auth);

// static home page
router.get('/', (req, res) => res.sendFile('index.html', { root: __dirname + '/../views' }));

// user auth & profile
router.post('/api/login', userCtrl.login);
router.get('/api/user/:id', userCtrl.getUser);
router.post('/api/profile/update', userCtrl.updateProfile);

// posts
router.get('/api/posts', postCtrl.listPosts);
router.get('/api/post/slug/:slug', postCtrl.getPostBySlug);
// hidden IDOR endpoint
router.get('/api/post', postCtrl.getPostById);

// admin panel
router.get('/admin', adminCtrl.adminPanel);

module.exports = router;
